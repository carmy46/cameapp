<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAME - Registrazione</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/effects.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="login-container">
        <!-- Left Side - Register Form -->
        <div class="login-form-section">
            <div class="particles">
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
            </div>
            <div class="login-form-container animate-card-entrance">
                <!-- Logo -->
                <div class="login-logo">
                    <div class="login-logo-icon">
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#0066FF;stop-opacity:1" />
                                    <stop offset="50%" style="stop-color:#8B5CF6;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#00D9B1;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <circle cx="24" cy="24" r="22" fill="url(#logoGradient)"/>
                            <path d="M18 16C21.866 16 25 19.134 25 23C25 26.866 21.866 30 18 30"
                                  stroke="white" stroke-width="3" stroke-linecap="round" fill="none"/>
                            <path d="M29 30L33 16L37 30"
                                  stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                            <path d="M31 26H35" stroke="white" stroke-width="3" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <h1 class="login-title gradient-text">CAME</h1>
                    <p class="login-subtitle">Crea il tuo account</p>
                </div>

                <!-- Register Form -->
                <form id="registerForm" class="login-form">
                    <div class="input-group">
                        <input type="text" id="firstName" name="firstName" placeholder=" " required>
                        <label for="firstName">Nome</label>
                        <div class="input-icon">
                            <i data-lucide="user"></i>
                        </div>
                    </div>

                    <div class="input-group">
                        <input type="text" id="lastName" name="lastName" placeholder=" " required>
                        <label for="lastName">Cognome</label>
                        <div class="input-icon">
                            <i data-lucide="user"></i>
                        </div>
                    </div>

                    <div class="input-group">
                        <input type="email" id="email" name="email" placeholder=" " required>
                        <label for="email">Email</label>
                        <div class="input-icon">
                            <i data-lucide="mail"></i>
                        </div>
                    </div>

                    <div class="input-group">
                        <input type="password" id="password" name="password" placeholder=" " required minlength="6">
                        <label for="password">Password (min. 6 caratteri)</label>
                        <div class="input-icon">
                            <i data-lucide="lock"></i>
                        </div>
                    </div>

                    <div class="input-group">
                        <input type="password" id="confirmPassword" name="confirmPassword" placeholder=" " required>
                        <label for="confirmPassword">Conferma Password</label>
                        <div class="input-icon">
                            <i data-lucide="lock"></i>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg w-full hover-glow-primary">
                        Registrati
                    </button>

                    <!-- Login Link -->
                    <div style="text-align: center; margin-top: 1.5rem;">
                        <p style="color: #6C757D; font-size: 0.9rem;">
                            Hai già un account? 
                            <a href="index.html" style="color: var(--primary-600); text-decoration: none; font-weight: 600;">
                                Accedi
                            </a>
                        </p>
                    </div>
                </form>
            </div>
        </div>

        <!-- Right Side - Hero -->
        <div class="login-hero-section gradient-overlay">
            <div class="morphing-bg" style="width: 300px; height: 300px; top: 10%; left: 20%;"></div>
            <div class="morphing-bg" style="width: 200px; height: 200px; bottom: 20%; right: 10%; animation-delay: -6s;"></div>
            <div class="hero-background"></div>
            <div class="login-hero-content animate-fade-in-up floating-element">
                <h1 class="hero-title">Unisciti a CAME</h1>
                <p class="hero-subtitle">Inizia a gestire la tua attività in modo professionale</p>

                <div class="hero-features">
                    <div class="hero-feature animate-fade-in-left">
                        <i data-lucide="shield-check" style="width: 24px; height: 24px;"></i>
                        <span>Sicuro e affidabile</span>
                    </div>
                    <div class="hero-feature animate-fade-in-left" style="animation-delay: 0.2s;">
                        <i data-lucide="zap" style="width: 24px; height: 24px;"></i>
                        <span>Setup in 2 minuti</span>
                    </div>
                    <div class="hero-feature animate-fade-in-left" style="animation-delay: 0.4s;">
                        <i data-lucide="cloud" style="width: 24px; height: 24px;"></i>
                        <span>Sincronizzazione cloud</span>
                    </div>
                    <div class="hero-feature animate-fade-in-left" style="animation-delay: 0.6s;">
                        <i data-lucide="smartphone" style="width: 24px; height: 24px;"></i>
                        <span>Accesso ovunque</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script src="js/firebase-config.js"></script>

    <!-- JavaScript Modules -->
    <script src="js/auth.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/ui.js"></script>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Register form handling
        document.getElementById('registerForm').addEventListener('submit', handleRegister);

        async function handleRegister(e) {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData(form);
            
            const firstName = formData.get('firstName').trim();
            const lastName = formData.get('lastName').trim();
            const email = formData.get('email').trim().toLowerCase();
            const password = formData.get('password').trim();
            const confirmPassword = formData.get('confirmPassword').trim();

            // Validation
            if (!firstName || !lastName || !email || !password || !confirmPassword) {
                showMessage('Compila tutti i campi', 'error');
                return;
            }

            if (password.length < 6) {
                showMessage('La password deve essere di almeno 6 caratteri', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showMessage('Le password non corrispondono', 'error');
                return;
            }

            if (!validateEmail(email)) {
                showMessage('Inserisci un indirizzo email valido', 'error');
                return;
            }

            // Show loading
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Registrazione in corso...';

            try {
                const result = await window.Auth.register(email, password, firstName, lastName, 'employee');

                if (result.success) {
                    showMessage('Registrazione completata! Reindirizzamento...', 'success');
                    
                    // Redirect to dashboard
                    setTimeout(() => {
                        window.location.href = 'employee-dashboard.html';
                    }, 1500);
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                console.error('Registration error:', error);
                showMessage('Errore durante la registrazione. Riprova.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }

        // Helper functions
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function showMessage(message, type) {
            if (window.UI && window.UI.showToast) {
                window.UI.showToast(message, type);
            } else {
                alert(message);
            }
        }

        // Initialize animations
        document.addEventListener('DOMContentLoaded', () => {
            const formElements = document.querySelectorAll('.login-form .input-group, .login-form .btn');
            formElements.forEach((el, index) => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(20px)';
                el.style.animation = `fadeInUp 0.6s ease-out forwards ${index * 0.1}s`;
            });

            setTimeout(() => {
                document.getElementById('firstName').focus();
            }, 500);
        });

        // Prevent access if already logged in
        if (window.Auth && window.Auth.isAuthenticated()) {
            const user = window.Auth.getCurrentUser();
            if (user) {
                const dashboardUrl = user.role === 'admin' ? 'admin-dashboard.html' : 'employee-dashboard.html';
                window.location.replace(dashboardUrl);
            }
        }
    </script>
</body>
</html>
